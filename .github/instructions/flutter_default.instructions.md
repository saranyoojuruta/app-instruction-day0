---
applyTo: '**'
---
- ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Flutter/Dart ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ prompt
- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ prompt ‡πÉ‡∏´‡πâ‡∏ó‡∏≥ todoli- ‡πÅ‡∏¢‡∏Å service ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô cross-feature (session/deeplink/analytics) ‡πÑ‡∏ß‡πâ core/services/
    - ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏û‡∏ß‡∏Å service ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏î‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏ô‡πÅ‡∏≠‡∏û ‚Üí ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏õ‡∏ú‡∏π‡∏Å‡∏°‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô features/ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà core/services/ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô
        - SessionService: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• session ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏ä‡πà‡∏ô access token, refresh token, current user
        - AuthSessionService: ‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏Å‡πá‡πÉ‡∏ä‡πâ AuthSessionService ‡∏î‡∏∂‡∏á token ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏≠‡∏á‡∏ã‡πâ‡∏≥
        - DeeplinkService: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û‡∏ú‡πà‡∏≤‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô)‡∏°‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

> UPDATE 2025-09: ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠: (1) ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á DI (‡πÉ‡∏ä‡πâ get_it + injectable ‡πÄ‡∏õ‡πá‡∏ô single source), (2) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô Result/Failure, (3) ‡∏£‡∏ß‡∏°‡∏ò‡∏µ‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà `theme.instructions.md`, (4) ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ token refresh concurrency, (5) ‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö i18n ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå, (6) ‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á API ‡πÄ‡∏Å‡πà‡∏≤ (Material 2) ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Material 3 ‡πÇ‡∏î‡∏¢‡∏¢‡∏±‡∏á‡∏Ñ‡∏á iOS look & feel.

## üèóÔ∏è Clean Architecture Rules

**Dependency Rule**: `Presentation ‚Üí Domain` ‡πÅ‡∏•‡∏∞ `Data ‚Üí Domain`
- Domain ‡πÄ‡∏õ‡πá‡∏ô Pure Dart (‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å Flutter/Dio/Storage)
- ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏ú‡πà‡∏≤‡∏ô interfaces ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡∏ó‡∏∏‡∏Å UseCase ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô `Result<T>` (sealed) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡πÅ‡∏ó‡∏ô throw
- DTO ‡∏ï‡πâ‡∏≠‡∏á map ‡πÄ‡∏õ‡πá‡∏ô Entity ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Data layer (‡∏´‡πâ‡∏≤‡∏° DTO ‡∏´‡∏•‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô Presentation)


## üìä Data Flow

```
UI (Page/Widget)
  ‚îî‚îÄ Controller (GetX) ‚Üí UseCase (Domain) ‚Üí Repository (Interface)
      ‚îî‚îÄ Repository Impl (Data) ‚Üí [API/Local] ‚Üí Mappers ‚Üí Result<T>
```

## üõ†Ô∏è Core Components

**Cross-cutting Services** (`core/services/`):
- **AuthSessionService**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ token & current user
- **DeeplinkService**: ‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏≠‡∏õ
- **AnalyticsService**: ‡∏™‡πà‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

**Network & Error**:
- ‡πÉ‡∏ä‡πâ Dio + interceptors (`access_token`, `refresh_token`, `error`, `user_agent`)
- ‡πÅ‡∏õ‡∏•‡∏á error ‡πÄ‡∏õ‡πá‡∏ô `Failure` ‡∏î‡πâ‡∏ß‡∏¢ `error_mapper` ‚Üí mapping matrix (Network/Timeout/Server/Auth/Validation/Unknown)
- ‡πÉ‡∏ä‡πâ `Result<T>` ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ `throw` (domain ‡πÑ‡∏°‡πà‡πÇ‡∏¢‡∏ô exception ‡∏Ç‡∏∂‡πâ‡∏ô UI)

**Token Refresh Concurrency Policy**:
1. Interceptor ‡∏ï‡∏£‡∏ß‡∏à 401 (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô endpoint refresh ‡πÄ‡∏≠‡∏á) ‚Üí ‡πÉ‡∏™‡πà request ‡πÉ‡∏ô queue ‡πÅ‡∏•‡πâ‡∏ß trigger refresh ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ refresh ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
2. ‡πÉ‡∏ä‡πâ mutex/flag ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô refresh ‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô `Completer<void>` ‡∏£‡∏≠‡∏ú‡∏•)
3. ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Üí replay queued requests ‡∏î‡πâ‡∏ß‡∏¢ header ‡πÉ‡∏´‡∏°‡πà
4. ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (invalid/expired refresh) ‚Üí ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå session + ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì logout (emit event ‡∏à‡∏≤‡∏Å AuthSessionService)
5. ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô replay/retry ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡πÄ‡∏ä‡πà‡∏ô 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô loop

Pseudo (‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î):
```
if (response.statusCode == 401) {
  enqueue(request);
  if (!refreshing) {
    refreshing = true;
    final r = await authRepo.refresh();
    refreshing = false;
    if (r.isSuccess) replayAll(); else failAll(AuthFailure.expired());
  }
  return pendingResponseFuture; // ‡∏£‡∏≠‡∏à‡∏ô refresh ‡πÄ‡∏™‡∏£‡πá‡∏à
}
```

**DI & Routing**:
- Composition Root: `app/injection.dart` 
- Feature Bindings: `features/<feature>/presentation/bindings/`
- Routes: `app/routes/app_routes.dart`  

## ‚öôÔ∏è Environment & i18n

**Environment Config**: 
```bash
flutter run --dart-define=ENV=dev/stg/prod
```

**Internationalization (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå)**:
Option A (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ): Flutter gen-l10n + ARB (`l10n/*.arb`) ‚Üí ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û & tooling ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
Option B: `flutter_i18n` + YAML (`assets/i18n/{en,th}.yaml`) ‚Üí ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á build step ‡πÄ‡∏û‡∏¥‡πà‡∏°
> ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Option A (gen-l10n)
‡πÉ‡∏ä‡πâ: `context.l10n.someKey`

‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ:
```
lib/
  l10n/
    app_en.arb
    app_th.arb
```
‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á `app_en.arb`:
```
{
  "appTitle": "Sample App",
  "welcomeMessage": "Welcome {userName}!",
  "@welcomeMessage": {
    "description": "Shown on the home screen greeting the user",
    "placeholders": {"userName": {"type": "String"}}
  }
}
```
‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î:
```
import 'package:flutter_gen/gen_l10n/app_localizations.dart';

// MaterialApp
MaterialApp(
  localizationsDelegates: AppLocalizations.localizationsDelegates,
  supportedLocales: AppLocalizations.supportedLocales,
  onGenerateTitle: (ctx) => ctx.l10n.appTitle,
  // ...
);

// ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô widget
final text = context.l10n.welcomeMessage(userName);
```
CI ‡πÄ‡∏û‡∏¥‡πà‡∏° build step (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ): `flutter gen-l10n` (‡∏£‡∏±‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô flutter build)

## üß™ Testing Strategy

‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á test mirror source: `test/features/<feature>/domain|data|presentation`
- **Domain**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö UseCase (mock repository)  
- **Data**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Repository impl + Mapper + Datasource
- **Presentation**: Widget/Controller tests  

## üîß ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà

1. **‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á**: `dart run tool/gen_feature.dart <FeatureName>`
2. **Domain**: ‡∏™‡∏£‡πâ‡∏≤‡∏á Entities, Repository (interface), UseCases
3. **Data**: ‡∏™‡∏£‡πâ‡∏≤‡∏á Models/Request, Mappers, Datasources, Repository Impl
4. **Presentation**: ‡∏™‡∏£‡πâ‡∏≤‡∏á Pages, Controllers, Bindings, Widgets
   - Controller ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å UseCase ‡πÄ‡∏™‡∏°‡∏≠ (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏Å datasource ‡∏ï‡∏£‡∏á)
   - ‡πÉ‡∏ä‡πâ StateMixins ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI state:
     - `StateMixin<T>` + `controller.obx()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
     - `PagingMixin` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö pagination
     - `RefreshMixin` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö pull-to-refresh
     - `ScrollMixin` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö scroll control
5. **Widgets**: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô `features/<feature>/presentation/widgets/`
6. **DI & Route**: ‡∏ú‡∏π‡∏Å‡πÉ‡∏ô `<feature>_binding.dart` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô `app_routes.dart`
7. **Tests**: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô test mirror source structure

---

## üìå Naming Conventions & Rules

**‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:**
- Use cases: `*_use_case.dart`
- Repository interface: `*_repository.dart` / implementation: `*_repository_impl.dart`
- Entities: `*_entity.dart`
- Controllers: `*_controller.dart`
- Pages: `*_page.dart` / Widgets: `*_widget.dart`
- Bindings: `*_binding.dart` / Services: `*_service.dart`

**‚úÖ Do:**
- UseCase ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Üí controller ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å usecase; usecase ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å repository
- Error ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Failure ‚Üí UI ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö exception ‡∏ó‡∏µ‡πà domain ‡πÑ‡∏°‡πà‡πÇ‡∏¢‡∏ô
- Import ‡πÅ‡∏ö‡∏ö package: `import 'package:app_name/...';`
- ‡πÅ‡∏¢‡∏Å cross-feature services ‡πÑ‡∏ß‡πâ `core/services/`
- Test mirror source structure
- DI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î register ‡πÉ‡∏ô get_it (injectable) ‡∏™‡πà‡∏ß‡∏ô GetX Binding = resolve ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà new instance
- Theme: ‡πÉ‡∏ä‡πâ `theme.instructions.md` ‡πÄ‡∏õ‡πá‡∏ô single source; ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏Å‡πâ ThemeData ‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢
- ‡πÉ‡∏ä‡πâ ColorScheme (Material 3) ‡πÅ‡∏ï‡πà‡∏õ‡∏£‡∏±‡∏ö palette ‡πÉ‡∏´‡πâ iOS-like ‡πÑ‡∏î‡πâ

**‚ùå Don't:**
- ‡∏´‡πâ‡∏≤‡∏° DTO ‡∏´‡∏•‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ domain/presentation ‚Üí map ‡∏ú‡πà‡∏≤‡∏ô mappers/
- Controller ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏Å datasource ‡∏ï‡∏£‡∏á ‚Üí ‡∏ú‡πà‡∏≤‡∏ô repository/usecase
- ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÉ‡∏ä‡πâ API Material 2 ‡∏ó‡∏µ‡πà deprecated (‡πÄ‡∏ä‡πà‡∏ô textTheme.headline1) ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà
- ‡∏´‡πâ‡∏≤‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á instance service ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà (single source DI)
- ‡∏≠‡∏¢‡πà‡∏≤ refresh token ‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ mutex)

### Result / Failure Contract (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)
Result<T> ‡∏°‡∏µ 2 ‡∏£‡∏π‡∏õ:
```
sealed class Result<T> {
  const Result();
  bool get isSuccess => this is Success<T>;
  bool get isFailure => this is FailureResult<T>;
  T get data => (this as Success<T>).value; // ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏ô‡πà‡πÉ‡∏à
  Failure get failure => (this as FailureResult<T>).error;
}
class Success<T> extends Result<T> { final T value; const Success(this.value); }
class FailureResult<T> extends Result<T> { final Failure error; const FailureResult(this.error); }
```
Failure (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á):
```
sealed class Failure { final String message; final Object? cause; const Failure(this.message,{this.cause}); }
class NetworkFailure extends Failure { const NetworkFailure(String m,{Object? cause}) : super(m,cause:cause); }
class TimeoutFailure extends Failure { const TimeoutFailure(String m): super(m); }
class AuthFailure extends Failure { final bool expired; const AuthFailure(String m,{this.expired=false}): super(m); }
class ValidationFailure extends Failure { final Map<String,String>? fieldErrors; const ValidationFailure(String m,{this.fieldErrors}); }
class ServerFailure extends Failure { final int? status; const ServerFailure(String m,{this.status}); }
class UnknownFailure extends Failure { const UnknownFailure(String m,{Object? cause}): super(m,cause:cause); }
```
UseCase pattern:
```
abstract class UseCase<T, P> { Future<Result<T>> call(P params); }
``` 
Controller ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
```
final r = await loginUseCase(LoginParams(...));
r.when(
  success: (u) => state = LoggedIn(u),
  failure: (f) => showError(f.message),
);
```

### DI Policy
- ‡∏ó‡∏∏‡∏Å dependency ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `injection.dart` (generate ‡∏î‡πâ‡∏ß‡∏¢ injectable)
- GetX Binding: `Get.put(GetIt.I<MyController>())` ‡∏´‡∏£‡∏∑‡∏≠ factory ‡∏à‡∏≤‡∏Å usecases ‡∏ó‡∏µ‡πà resolve ‡πÅ‡∏•‡πâ‡∏ß
- ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á manual singleton ‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô get_it

### Token Refresh Edge Cases
- Refresh 401 ‡πÅ‡∏•‡πâ‡∏ß 401 ‡∏ã‡πâ‡∏≥‡∏≠‡∏µ‡∏Å ‚Üí ‡∏¢‡∏∏‡∏ï‡∏¥ flow ‡πÅ‡∏•‡∏∞ logout
- Refresh endpoint timeout ‚Üí retry 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
- ‡πÄ‡∏Å‡∏¥‡∏ô max queued requests (‡πÄ‡∏ä‡πà‡∏ô 30) ‚Üí fail ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢ AuthFailure

### ‡∏™‡∏µ / withValues
- ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö RGBA ‡πÉ‡∏´‡πâ implement extension ‡∏ä‡∏∑‡πà‡∏≠ `withValues({int? r,int? g,int? b,int? a})` ‡πÉ‡∏ô `core/extensions/color_extension.dart`
- ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á `withOpacity(0.x)` ‡∏ö‡πà‡∏≠‡∏¢ ‡πÜ ‡πÉ‡∏ô‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏≥ palette ‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏à‡∏≤‡∏Å ColorScheme

### THEME
‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏µ‡πà `theme.instructions.md` (‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô source of truth ‡∏î‡πâ‡∏≤‡∏ô‡∏ò‡∏µ‡∏°‡πÅ‡∏•‡πâ‡∏ß)

### Home Navigation (5 Tabs)
‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Home + Bottom Navigation 5 ‡∏õ‡∏∏‡πà‡∏° ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `home_navigation.instructions.md` (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á controller, deeplink, analytics, badge, lazy init)

## üñºÔ∏è Wireframe Screen Mapping (SC-XX/WG-XX)

**Multi-state**: SC-XX ‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚Üí ‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô 1 page + ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ state
**Multi-tab**: WG-XX ‡πÅ‡∏¢‡∏Å Tab ‚Üí main page + TabBar + ‡πÅ‡∏ï‡πà‡∏•‡∏∞ tab ‡πÅ‡∏¢‡∏Å controller
**Orchestrator Pattern**: ‡πÉ‡∏ä‡πâ OrchestratorService ‡πÉ‡∏ô `core/services/` ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ WG widget

## üß© Dependencies ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ

```yaml
dependencies:
  get: ^4.6.5
  get_it: ^7.6.0
  injectable: ^2.3.0
  flutter_i18n: ^0.32.0
  dio: ^5.4.0
  shared_preferences: ^2.2.2
  flutter_secure_storage: ^9.0.0
```

---

## üß≠ ‡∏Å‡∏é‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡πÅ‡∏ï‡πà‡∏ä‡πà‡∏ß‡∏¢ ‚Äú‡∏Å‡∏±‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏û‡∏±‡∏á‚Äù
### ‚úÖ Do
- UseCase ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Üí controller ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å usecase; usecase ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å repository
- Error ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Failure ‚Üí UI ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- Interceptor ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á UI ‚Üí ‡πÅ‡∏Ñ‡πà‡πÇ‡∏¢‡∏ô error ‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
- ‡∏Å‡∏≤‡∏£ import ‡πÉ‡∏´‡πâ import ‡πÅ‡∏ö‡∏ö package ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà relative path ‡∏≠‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡πÉ‡∏ô pubspec.yaml ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏ï‡πâ lib/
  - ‡πÉ‡∏ä‡πâ relative ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©
    - ‡πÑ‡∏ü‡∏•‡πå part/part of ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    - ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏•‡πá‡∏Å‡πÜ/‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    - ‡πÅ‡∏ï‡πà‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£ ‚Äú‡∏ú‡∏™‡∏°‚Äù relative ‡πÅ‡∏•‡∏∞ package: ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
- ‡πÅ‡∏¢‡∏Å service ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô cross-feature (session/fcm/deeplink/analytics) ‡πÑ‡∏ß‡πâ core/services/
    - ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏û‡∏ß‡∏Å service ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏î‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏ô‡πÅ‡∏≠‡∏û ‚Üí ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏õ‡∏ú‡∏π‡∏Å‡∏°‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô features/ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà core/services/ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô
        - SessionService: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• session ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏ä‡πà‡∏ô access token, refresh token, current user
        - AuthSessionService: ‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏Å‡πá‡πÉ‡∏ä‡πâ AuthSessionService ‡∏î‡∏∂‡∏á token ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏≠‡∏á‡∏ã‡πâ‡∏≥
        - DeeplinkService: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û‡∏ú‡πà‡∏≤‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô)
        <!-- - AnalyticsService: ‡∏™‡πà‡∏á event ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Analytics, Firebase Analytics, ‡∏´‡∏£‡∏∑‡∏≠ Amplitude -->
- Test ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á mirror source ‚Üí test/features/<feature>/...


### ‚ùå Don't
- ‡∏´‡πâ‡∏≤‡∏° DTO ‡∏´‡∏•‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ domain/presentation ‚Üí map ‡∏ú‡πà‡∏≤‡∏ô mappers/ ‡πÄ‡∏™‡∏°‡∏≠
- Controller ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏Å datasource ‡∏ï‡∏£‡∏á ‚Üí ‡∏ú‡πà‡∏≤‡∏ô repository/usecase ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô‡∏ò‡∏µ‡∏° 
<!-- ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ withOpacity ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡πÇ‡∏õ‡∏£‡∏á‡πÉ‡∏™‡∏™‡∏µ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ withValues -->



